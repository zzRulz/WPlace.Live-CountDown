<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wplace ‚Äì Recharge de pixels</title>
  <meta name="description" content="Entrez vos pixels actuels pour conna√Ætre le temps restant et l'heure de recharge compl√®te.">
  <style>
    :root{--bg:#0b0f14;--card:#121821;--muted:#93a1b1;--text:#e6edf3;--accent:#7cd3ff;--ok:#9ae6b4;--warn:#ffd166}
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;background:radial-gradient(80vw 80vh at 10% 20%,#0f1622 0%,#0b0f14 60%),var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:920px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 24px}
    h1{font-weight:800;font-size:clamp(20px,2.8vw,28px);letter-spacing:.3px;margin:0}
    .cluster{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px 2px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:#0d131c;color:var(--text);outline:none}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,211,255,.15)}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .results{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:18px}
    .stat{padding:16px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08)}
    .stat h3{margin:0 0 8px;font-size:13px;color:var(--muted);font-weight:600}
    .stat .value{font-size:clamp(20px,3.5vw,30px);font-weight:800;letter-spacing:.3px}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0d151f;border:1px solid rgba(255,255,255,.12);font-size:12px;color:var(--muted)}
    .footer{margin-top:28px;color:var(--muted);font-size:12px;text-align:center}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{cursor:pointer;user-select:none;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f1722;color:var(--text)}
    .btn:hover{border-color:var(--accent)}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{position:relative;display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:#0d131c;color:var(--text);cursor:pointer;user-select:none;font-size:14px}
    .tab[aria-selected="true"]{outline:2px solid rgba(124,211,255,.35)}
    .status{width:10px;height:10px;border-radius:999px;box-shadow:0 0 0 1px rgba(0,0,0,.5) inset}
    .status.full{background:#1db954}
    .status.notfull{background:#ff4d4f;animation:blink 1s step-start infinite}
    @keyframes blink{50%{opacity:.35}}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;pointer-events:none;transition:opacity .3s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Wplace ¬∑ Recharge de pixels</h1>
      <div class="cluster">
        <div class="pill" id="tz"></div>
      </div>
    </header>

    <section class="card" style="margin-bottom:16px">
      <div class="tabs" id="profileTabs" role="tablist" aria-label="Comptes"></div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="addProfile">‚ûï Nouveau</button>
        <button class="btn" id="renameProfile">‚úèÔ∏è Renommer</button>
        <button class="btn" id="deleteProfile">üóëÔ∏è Supprimer</button>
      </div>
    </section>

    <section class="card">
      <div class="grid">
        <div>
          <label for="current">Pixels actuels</label>
          <input id="current" type="number" min="0" step="1" />
          <div class="hint">Ce que tu as maintenant.</div>
        </div>
        <div>
          <label for="capacity">Capacit√© max</label>
          <input id="capacity" type="number" min="1" step="1" value="300" />
          <div class="hint">Par d√©faut 300 (modifie si ton compte a un autre maximum).</div>
        </div>
        <div>
          <label for="rate">R√©g√©n√©ration (secondes / pixel)</label>
          <input id="rate" type="number" min="1" step="1" value="30" />
          <div class="hint">wplace: 1 pixel toutes les 30s (par d√©faut).</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn" id="startBtn">‚ñ∂Ô∏è Start</button>
      </div>

      <div class="results">
        <div class="stat">
          <h3>Temps restant</h3>
          <div class="value" id="remaining">‚Äì</div>
          <div class="hint" id="missing">Pixels manquants : ‚Äì</div>
        </div>
        <div class="stat">
          <h3>Heure de recharge compl√®te</h3>
          <div class="value" id="fullAt">‚Äì</div>
          <div class="hint">Heure locale de ton navigateur.</div>
        </div>
        <div class="stat">
          <h3>Compte √† rebours</h3>
          <div class="value" id="countdown">‚Äì</div>
          <div class="hint">Se met √† jour en direct.</div>
        </div>
      </div>

      <div class="row" style="margin-top:16px">
        <span class="muted">Chaque compte est sauvegard√© en localStorage. Les onglets passent <span class="ok">verts</span> s'ils sont pleins, <span class="warn">rouges clignotants</span> sinon.</span>
      </div>
    </section>

    <p class="footer">Astuce : cr√©e un onglet par compte. Les donn√©es restent sur ton appareil (localStorage).</p>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const $ = sel => document.querySelector(sel);
    const currentEl = $('#current');
    const capacityEl = $('#capacity');
    const rateEl = $('#rate');
    const remainingEl = $('#remaining');
    const fullAtEl = $('#fullAt');
    const countdownEl = $('#countdown');
    const missingEl = $('#missing');
    const tzEl = $('#tz');
    const startBtn = $('#startBtn');

    const PROFILES_KEY = 'wplace_profiles_v1';
    const ACTIVE_KEY = 'wplace_active_profile_v1';
    const tabsEl = document.getElementById('profileTabs');
    const toastEl = document.getElementById('toast');

    let started = false;

    function showToast(msg){
      toastEl.textContent=msg;
      toastEl.classList.add('show');
      setTimeout(()=>toastEl.classList.remove('show'),1500);
    }

    function fmtDuration(totalSeconds){
      totalSeconds = Math.max(0, Math.floor(totalSeconds));
      const d = Math.floor(totalSeconds / 86400);
      const h = Math.floor((totalSeconds % 86400) / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      const s = totalSeconds % 60;
      const parts = [];
      if(d) parts.push(`${d}j`);
      if(h || d) parts.push(`${h}h`);
      parts.push(`${m}m`);
      parts.push(`${s}s`);
      return parts.join(' ');
    }
    function fmtClock(date){
      const opts = {weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit', second:'2-digit'};
      return new Intl.DateTimeFormat(navigator.language || 'fr-FR', opts).format(date);
    }
    function calcSeconds(missing, rate){
      return Math.max(0, Math.floor(missing) * Math.max(1, Math.floor(rate)));
    }

    function loadProfiles(){
      try{ return JSON.parse(localStorage.getItem(PROFILES_KEY) || '{}'); }catch{ return {}; }
    }
    function saveProfiles(p){ try{ localStorage.setItem(PROFILES_KEY, JSON.stringify(p)); }catch{} }
    function getActiveProfile(){ try{ return localStorage.getItem(ACTIVE_KEY); }catch{ return null; } }
    function setActiveProfile(name){ try{ localStorage.setItem(ACTIVE_KEY, name); }catch{} }

    function ensureBootstrap(){
      const p = loadProfiles();
      const names = Object.keys(p);
      if(names.length===0){ p['Compte 1']={current:0,capacity:300,rate:30,fullAt:Date.now()}; saveProfiles(p); setActiveProfile('Compte 1'); }
      else if(!getActiveProfile()||!p[getActiveProfile()]) setActiveProfile(names[0]);
    }

    function renderTabs(){
      const profiles = loadProfiles();
      const active = getActiveProfile();
      const now = Date.now();
      tabsEl.innerHTML='';
      Object.entries(profiles).forEach(([name,data])=>{
        const cap = Number(data.capacity)||300;
        const rate = Math.max(1, Number(data.rate)||30);
        let cur = Number(data.current)||0;
        if(data.fullAt && started){
          const remainSec = Math.max(0, Math.ceil((data.fullAt - now)/1000));
          const gained = Math.floor(((cap-cur)*rate - remainSec)/rate);
          cur = Math.min(cap, cur + Math.max(0,gained));
        }
        const full = cur>=cap;
        const btn=document.createElement('button');
        btn.className='tab';
        btn.setAttribute('role','tab');
        btn.setAttribute('aria-selected',String(name===active));
        const dot=document.createElement('span');
        dot.className='status '+(full?'full':'notfull');
        const label=document.createElement('span');
        label.textContent=`${name} (${cur}/${cap})`;
        btn.appendChild(dot);
        btn.appendChild(label);
        btn.addEventListener('click',()=>{ setActiveProfile(name); loadActiveProfileIntoUI(); renderTabs(); });
        tabsEl.appendChild(btn);
      });
    }

    function loadActiveProfileIntoUI(){
      const p=loadProfiles();
      const active=getActiveProfile();
      const d=p[active]||{current:0,capacity:300,rate:30,fullAt:Date.now()};
      currentEl.value=d.current;
      capacityEl.value=d.capacity;
      rateEl.value=d.rate;
      if(d.fullAt){
        targetTs=d.fullAt;
      }
      if(started) recalc(true);
    }

    function upsertActiveFromUI(targetOverride){
      const p=loadProfiles();
      const active=getActiveProfile();
      if(!active) return;
      const payload = {
        current: Number(currentEl.value||0),
        capacity: Math.max(1, Number(capacityEl.value||300)),
        rate: Math.max(1, Number(rateEl.value||30)),
        fullAt: targetOverride||targetTs
      };
      p[active]=payload;
      saveProfiles(p);
    }

    function createProfile(){
      const p=loadProfiles(); let i=1; let name; do{name=`Compte ${++i}`}while(p[name]);
      p[name]={current:0,capacity:300,rate:30,fullAt:Date.now()}; saveProfiles(p); setActiveProfile(name); renderTabs(); loadActiveProfileIntoUI();
      showToast(`Profil ${name} cr√©√©`);
    }
    function renameProfile(){
      const active=getActiveProfile(); if(!active) return;
      const newName=prompt('Nouveau nom :',active); if(!newName||newName===active) return;
      const p=loadProfiles(); if(p[newName]){alert('Existe d√©j√†'); return;}
      p[newName]=p[active]; delete p[active]; saveProfiles(p); setActiveProfile(newName); renderTabs(); loadActiveProfileIntoUI();
      showToast(`Profil renomm√© en ${newName}`);
    }
    function deleteProfile(){
      const active=getActiveProfile(); const p=loadProfiles(); const names=Object.keys(p);
      if(names.length<=1){alert('Au moins un profil'); return;}
      if(!confirm(`Supprimer ${active}?`)) return;
      delete p[active]; saveProfiles(p); setActiveProfile(Object.keys(p)[0]); renderTabs(); loadActiveProfileIntoUI();
      showToast(`Profil ${active} supprim√©`);
    }

    function compute(){
      const curr=Number(currentEl.value||0);
      const cap=Math.max(1,Number(capacityEl.value||300));
      const rate=Math.max(1,Number(rateEl.value||30));
      const missing=Math.max(0,cap-curr);
      missingEl.textContent=`Pixels manquants : ${missing}`;
      if(missing===0){ remainingEl.innerHTML='<span class="ok">D√©j√† plein</span>'; fullAtEl.textContent=fmtClock(new Date()); return{target:Date.now()}; }
      const secs=calcSeconds(missing,rate); remainingEl.textContent=fmtDuration(secs);
      const target=Date.now()+secs*1000; fullAtEl.textContent=fmtClock(new Date(target)); return{target};
    }

    try{ tzEl.textContent=`Heure locale : ${Intl.DateTimeFormat().resolvedOptions().timeZone}`; }catch{ tzEl.style.display='none'; }

    let targetTs=0;
    function tick(){
      if(started){
        const now=Date.now();
        const remain=Math.max(0,targetTs-now);
        countdownEl.textContent=fmtDuration(remain/1000);
        renderTabs();
      }
      requestAnimationFrame(tick);
    }
    function recalc(skip=false){ targetTs=compute().target; if(!skip) upsertActiveFromUI(targetTs); renderTabs(); }

    startBtn.addEventListener('click',()=>{
      started = true;
      recalc(false);
      showToast('D√©marr√© !');
    });

    ensureBootstrap(); renderTabs(); loadActiveProfileIntoUI(); tick();

    // Bind UI events
    document.getElementById('addProfile').addEventListener('click', createProfile);
    document.getElementById('renameProfile').addEventListener('click', renameProfile);
    document.getElementById('deleteProfile').addEventListener('click', deleteProfile);
    [currentEl,capacityEl,rateEl].forEach(el=>{
      el.addEventListener('input', ()=>{ if(started) recalc(false); });
      el.addEventListener('change', ()=>{ if(started) recalc(false); });
    });
  </script>
</body>
</html>